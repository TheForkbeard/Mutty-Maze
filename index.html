<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mutty Maze</title>
</head>
<body>
    <header>
        <h1>Mutty Maze</h1>
    </header>
    <div id="view-port"></div>
    <div class="controls"></div>

    <script>

        (function() {
            // canvas variables
            let canvas = document.querySelector("canvas");
            let drawingSurface = canvas.getContext("2d");

            // game map variable
            let map = [
                [2, 2, 2, 2, 2, 2, 2],
                [2, 1, 1, 1, 2, 1, 2],
                [2, 1, 2, 1, 2, 1, 2],
                [2, 1, 2, 1, 1, 1, 2],
                [2, 1, 2, 2, 2, 1, 2],
                [2, 1, 1, 1, 2, 1, 2],
                [2, 2, 2, 2, 2, 2, 2]
            ];

            // game object variable
            let gameObject = [
                [0, 0, 0, 0, 0, 0, 0],
                [0, 3, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0]
            ];

            //map codes
            const EMPTY = 0;
            const FLOOR  = 1;
            const WALL = 2;
            const MUTTY = 3;

            // the size of each tile cell, this is what I need to be able to adapt make this work
            const SIZE = 64;
            // lets see if that works?



            let mutty = null;

            // forgot to include the sprite objects
            let sprite = {
            sourceX: 0,
            sourceY: 0,
            sourceWidth: 64,
            sourceHeight: 64,
            x: 0,
            y: 0,
            height: 64,
            width: 64
        };

            const ROWS = map.length;
            const COLUMNS = map[0].length;

            // the number of columns on the tilesheet,  not sure about how this works yet but will observe
            let tilesheetColumns = 3;

            // the arrays for the game objects
            let sprites = [];
            let walls = [];

            // now to start the rendering proccess 
            let assetsToLoad = [];
            let assetsLoaded =0;

            / load the tilesheet image
            let image = new image();
            image.addEventListener("load", loadHandler, false);
            image.src = "assets/images/mutty-tile-2.png";
            assetsToLoad.push(image);

            

            // and call the render function
            render();

            // to test the rendering I will contstruct basic loadHandler, buildMap and render functions
            
            function loadHandler() {
                assetsLoaded++;
                if(assetsLoaded === assetsToLoad.length) {
                    // when assetsLoaded is finished remove the load handler
                    image.removeEventListener("load", loadHandler, false);

                    // this is to test if my idea will render calling the buildmap function twice to be able to render it
                    buildMap(map);
                    buildMap(gameObjects);
                }
            }

            // the buildMap function
            function buildMap(levelMap) {
                for(let row = 0; row < ROWS; row++) {
                    for(let column = 0; column , COLUMNS; column++) {
                        let currentTile = levelMap[row][column];
                        if(currentTile !== EMPTY) {
                            // find the tile's x and y position on the tile sheet
                            let tilesheetX = Math.floor((currentTile - 1) % tilesheetColumns) * SIZE;
                            let tilesheetY = Math.floor((currentTile - 1) / tilesheetColumns) * SIZE;

                            switch(currentTile) {
                                case FLOOR: 
                                    let floor = Object.create(sprite);
                                    floor.sourceX = tilesheetX;
                                    floor.sourceY = tilesheetY;
                                    floor.x = column * SIZE;
                                    floor.y = row * SIZE;
                                    sprites.push(floor);
                                    break;
                                
                                case WALL:
                                    let wall = Object.create(sprite);
                                    wall.sourceX = tilesheetX;
                                    wall.sourceY = tilesheetY;
                                    wall.x = column * SIZE;
                                    wall.y = row *  SIZE;
                                    sprites.push(wall);
                                    walls.push(wall);
                                    break;
                                
                                case MUTTY:
                                    mutty = Object.create(sprite);
                                    mutty.sourceX = tilesheetX;
                                    mutty.sourceY = tilesheetY;
                                    mutty.x = column * SIZE;
                                    mutty.y = row * SIZE;
                                    sprites.push(mutty);
                                    break;
                            }
                        }
                    }
                }
            }

            // thats the map built need to render it with a render function next
            


        }());


    </script>
</body>
</html>